<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ƒê·∫∑t h√†ng th√†nh c√¥ng - Florio Flower Shop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <link rel="stylesheet" th:href="@{/assets/css/order-success.css}">
  <link rel="stylesheet" th:href="@{/assets/css/header.css}">
  <link rel="stylesheet" th:href="@{/assets/css/footer.css}">
  <style>
      /* Th√™m style cho d√≤ng gi·∫£m gi√° */
      .summary-discount-row {
          color: #198754; /* M√†u xanh l√° */
          font-weight: 500;
      }
  </style>
</head>
<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container container-narrow my-4">
  <div class="success-hero mb-4">
    <div class="d-flex align-items-center gap-3">
      <div class="success-badge">
        <i class="bi bi-check-lg"></i>
      </div>
      <div>
        <h4 class="mb-1 fw-bold" style="color:var(--ink)">ƒê·∫∑t h√†ng th√†nh c√¥ng!</h4>
        <div class="order-meta">
          <span class="me-2">M√£ ƒë∆°n h√†ng:
            <span class="badge text-bg-dark" th:text="${order.id}">#0</span>
          </span>
          <span class="badge badge-status" th:text="${order.status} ?: 'ƒêang x·ª≠ l√Ω'">PENDING</span>
        </div>
      </div>
      <div class="ms-auto">
        <button class="btn btn-ghost" onclick="window.print()">
          <i class="bi bi-printer"></i> In ho√° ƒë∆°n
        </button>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-6">
      <div class="soft-card">
        <div class="card-body">
          <div class="section-title"><i class="bi bi-person-lines-fill text-primary"></i><span>Th√¥ng tin nh·∫≠n h√†ng</span></div>
          <div class="kv"><div class="k">H·ªç v√† t√™n</div><div class="v" th:text="${order.recipientName}">Kh√°ch h√†ng</div></div>
          <div class="kv"><div class="k">S·ªë ƒëi·ªán tho·∫°i</div><div class="v" th:text="${order.recipientPhone}">000000000</div></div>
          <div class="kv"><div class="k">ƒê·ªãa ch·ªâ</div><div class="v" th:text="${order.shippingAddress}">ƒê·ªãa ch·ªâ</div></div>
          <div class="kv" th:if="${order.note}">
            <div class="k">Ghi ch√∫</div><div class="v" th:text="${order.note}">Ghi ch√∫...</div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="soft-card">
        <div class="card-body">
          <div class="section-title"><i class="bi bi-gear text-success"></i><span>Th√¥ng tin ƒë∆°n h√†ng</span></div>

          <div class="kv" th:with="pm=${order.paymentMethod != null ? order.paymentMethod : 'COD'}">
            <div class="k">Thanh to√°n</div>
            <div class="v">
              <span th:text="${pm == 'BANK'} ? 'Chuy·ªÉn kho·∫£n' : (${pm == 'VNPAY'} ? 'VNPAY' : 'Thanh to√°n khi nh·∫≠n h√†ng (COD)')">COD</span>
            </div>
          </div>

          <div class="kv">
            <div class="k">Ng√†y ƒë·∫∑t</div>
            <div class="v" th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}">--/--/----</div>
          </div>

          <div class="divider-dashed"></div>
          <div class="small text-secondary">
            C·∫£m ∆°n b·∫°n ƒë√£ tin t∆∞·ªüng Florio! Ch√∫ng t√¥i s·∫Ω li√™n h·ªá x√°c nh·∫≠n v√† giao h√†ng s·ªõm nh·∫•t üíê
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-lg-8">
      <div class="soft-card">
        <div class="card-body">
          <div class="section-title"><i class="bi bi-receipt text-danger"></i><span>Chi ti·∫øt ƒë∆°n h√†ng</span></div>

          <div class="table-responsive">
            <table class="table table-products table-sm align-middle">
              <thead class="table-light">
                <tr>
                  <th>S·∫£n ph·∫©m</th>
                  <th class="text-center" style="width:100px;">SL</th>
                  <th class="text-end" style="width:160px;">ƒê∆°n gi√°</th>
                  <th class="text-end" style="width:180px;">Th√†nh ti·ªÅn</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="d : ${order.details}"
                    th:with="
                      qty=${d.quantity != null ? d.quantity.longValue() : 0L},
                      lineTotal=${(d.price != null) ? d.price.multiply(T(java.math.BigDecimal).valueOf(qty)) : T(java.math.BigDecimal).ZERO}
                    ">
                  <td th:text="${d.product != null ? d.product.productName : 'S·∫£n ph·∫©m'}">T√™n SP</td>
                  <td class="text-center" th:text="${d.quantity}">1</td>
                  <td class="text-end" th:text="${#numbers.formatDecimal(d.price,0,'COMMA',0,'POINT')} + 'ƒë'">0ƒë</td>
                  <td class="text-end fw-semibold" th:text="${#numbers.formatDecimal(lineTotal,0,'COMMA',0,'POINT')} + 'ƒë'">0ƒë</td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="summary">
        <div class="section-title mb-2"><i class="bi bi-cash-coin text-warning"></i><span>T·ªïng k·∫øt</span></div>

        <div th:with="
              totalFinal = ${order.totalAmount != null ? order.totalAmount : T(java.math.BigDecimal).ZERO},
              ship  = ${order.shippingFee  != null ? order.shippingFee  : T(java.math.BigDecimal).ZERO},
              discount = ${order.discountAmount != null ? order.discountAmount : T(java.math.BigDecimal).ZERO},
              sub   = ${totalFinal.add(discount).subtract(ship)}  /* T√≠nh l·∫°i subtotal tr∆∞·ªõc gi·∫£m gi√° */
            ">
          <div class="row-item">
            <div class="label">T·∫°m t√≠nh</div>
            <div class="val" th:text="${#numbers.formatDecimal(sub,0,'COMMA',0,'POINT')} + 'ƒë'">0ƒë</div>
          </div>
          <div class="row-item">
            <div class="label">Ph√≠ v·∫≠n chuy·ªÉn</div>
            <div class="val" th:text="${#numbers.formatDecimal(ship,0,'COMMA',0,'POINT')} + 'ƒë'">0ƒë</div>
          </div>
           {/* */}
           <div class="row-item summary-discount-row" th:if="${discount.compareTo(T(java.math.BigDecimal).ZERO) > 0}">
              <div class="label">Gi·∫£m gi√° <span th:if="${order.discountCode != null}" th:text="'(' + ${order.discountCode.code} + ')'"></span></div>
              <div class="val" th:text="${#numbers.formatDecimal(discount.negate(), 0, 'COMMA', 0, 'POINT')} + 'ƒë'">-0ƒë</div>
           </div>
          <div class="divider-dashed"></div>
          <div class="row-item">
            <div class="label fw-bold">T·ªïng c·ªông</div>
            <div class="val total" th:text="${#numbers.formatDecimal(totalFinal,0,'COMMA',0,'POINT')} + 'ƒë'">0ƒë</div> {/* */}
          </div>

          <div th:if="${pendingVnpayPayment}" class="mt-3 text-center alert alert-warning p-2">
              <small>ƒê∆°n h√†ng n√†y ƒëang ch·ªù thanh to√°n qua VNPAY.</small>
              <div th:if="${vnpayPaymentUrl}" class="mt-2 d-grid">
                  <a th:href="${vnpayPaymentUrl}" class="btn btn-warning fw-bold btn-sm">
                      <i class="bi bi-credit-card-2-front"></i> Thanh to√°n ngay qua VNPAY
                  </a>
              </div>
              <div th:if="${vnpayError}" class="mt-2 text-danger small" th:text="${vnpayError}">
                  L·ªói t·∫°o link thanh to√°n.
              </div>
          </div>
          <div class="d-grid gap-2 mt-3">
            <a class="btn btn-outline-secondary" th:href="@{/}">
              <i class="bi bi-bag"></i> Ti·∫øp t·ª•c mua s·∫Øm
            </a>
            <a class="btn btn-primary" th:href="@{/orders}">
              <i class="bi bi-clock-history"></i> Xem l·ªãch s·ª≠ ƒë·∫∑t h√†ng
            </a>
            <button class="btn btn-ghost" onclick="window.print()">
              <i class="bi bi-printer"></i> In ho√° ƒë∆°n
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="text-center text-secondary small mt-4">
    <i class="bi bi-flower1"></i> C·∫£m ∆°n b·∫°n ƒë√£ ch·ªçn Florio. Ch√∫c b·∫°n m·ªôt ng√†y t∆∞∆°i xinh!
  </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>