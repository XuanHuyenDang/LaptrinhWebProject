<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Thanh to√°n ƒë∆°n h√†ng - Florio Flower Shop</title>
  <meta name="_csrf" th:if="${_csrf}" th:content="${_csrf.token}">
  <meta name="_csrf_header" th:if="${_csrf}" th:content="${_csrf.headerName}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .section-title { font-weight: 600; }
    .btn-spinner {
      display: inline-flex; align-items:center; gap:.5rem;
    }
    .btn-spinner .spinner-border { width:1rem; height:1rem; }
    .badge-legend { font-size:.85rem; opacity:.9; }
    /* Th√™m style ƒë·ªÉ label c·ªßa VNPAY d·ªÖ nh√¨n h∆°n */
    label[for="payVNPAY"] img {
        height: 20px; /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc logo VNPAY n·∫øu c·∫ßn */
        vertical-align: middle;
        margin-left: 5px;
    }
  </style>
</head>
<body class="bg-light">

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container" style="max-width: 980px;">
  <h3 class="text-center text-danger my-4"><i class="bi bi-credit-card"></i> Thanh to√°n ƒë∆°n h√†ng</h3>

  <script th:inline="javascript">
    // Bi·∫øn c·ªù x√°c ƒë·ªãnh lu·ªìng
    const IS_BUY_NOW = /*[[${isBuyNow}]]*/ false;

    // Th√¥ng tin s·∫£n ph·∫©m Mua Ngay (ch·ªâ c√≥ gi√° tr·ªã n·∫øu IS_BUY_NOW = true)
    const BUY_NOW_PRODUCT_ID = /*[[${buyNowProductId}]]*/ null;
    const BUY_NOW_QTY = /*[[${buyNowQty}]]*/ null;

    // CartView (ho·∫∑c l√† cart th·∫≠t, ho·∫∑c l√† cart "·∫£o" t·ª´ controller)
    let CART = /*[[${cart}]]*/ null;

    // URL API
    const API_BASE = /*[[@{/api/cart}]]*/ '/api/cart';
    // URL trang ƒëƒÉng nh·∫≠p (ƒë·ªÉ x·ª≠ l√Ω l·ªói 401/403)
    const LOGIN_URL = /*[[@{/auth/login}]]*/ '/auth/login';
    // URL trang s·∫£n ph·∫©m (ƒë·ªÉ x·ª≠ l√Ω gi·ªè h√†ng tr·ªëng)
    const PRODUCTS_URL = /*[[@{/products}]]*/ '/products';
    // URL trang th√†nh c√¥ng (d√πng khi COD/BANK)
    const ORDER_SUCCESS_URL_BASE = /*[[@{/orders/}]]*/ '/orders/';
  </script>


  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="section-title mb-3"><i class="bi bi-truck"></i> Th√¥ng tin giao h√†ng</h5>

          <div class="mb-3">
            <label class="form-label">H·ªç v√† t√™n *</label>
            <input id="name" type="text" class="form-control" required th:value="${account?.fullName}">
          </div>
          <div class="mb-3">
            <label class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label>
            <input id="phone" type="text" class="form-control" required th:value="${account?.phoneNumber}">
          </div>
          <div class="mb-3">
            <label class="form-label">ƒê·ªãa ch·ªâ giao h√†ng *</label>
            <input id="address" type="text" class="form-control" required th:value="${account?.address}">
          </div>
          <div class="mb-3">
            <label class="form-label">Ghi ch√∫</label>
            <textarea id="note" rows="2" class="form-control" placeholder="V√≠ d·ª•: Giao gi·ªù h√†nh ch√≠nh, g·ªçi tr∆∞·ªõc..."></textarea>
          </div>

          <h6 class="mb-2">H√¨nh th·ª©c thanh to√°n *</h6>
          <div class="form-check">
            <input class="form-check-input payment-method" type="radio" name="pay" id="payCOD" value="COD" checked>
            <label class="form-check-label" for="payCOD">üíµ Thanh to√°n khi nh·∫≠n h√†ng (COD)</label>
          </div>
          <div class="form-check">
             <input class="form-check-input payment-method" type="radio" name="pay" id="payVNPAY" value="VNPAY">
             <label class="form-check-label" for="payVNPAY">
                üí≥ Thanh to√°n qua VNPAY
                <img src="https://sandbox.vnpayment.vn/apis/assets/images/logo-vnpay-sm.png" alt="VNPAY Logo">
             </label>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input payment-method" type="radio" name="pay" id="payBANK" value="BANK">
            <label class="form-check-label" for="payBANK">üè¶ Chuy·ªÉn kho·∫£n ng√¢n h√†ng (Th·ªß c√¥ng)</label>
          </div>

          <div id="bankInfo" class="alert alert-secondary small d-none">
            <strong>Ng√¢n h√†ng:</strong> Vietcombank<br>
            <strong>S·ªë TK:</strong> 0123456789 (Florio Flower Shop)<br>
            <strong>N·ªôi dung:</strong> [T√™n KH] - [SƒêT] - Thanh to√°n ƒë∆°n h√†ng #[M√£ ƒë∆°n h√†ng]
            <br><small class="text-danger">L∆∞u √Ω: ƒê∆°n h√†ng ch·ªâ ƒë∆∞·ª£c x·ª≠ l√Ω sau khi shop x√°c nh·∫≠n ƒë√£ nh·∫≠n ƒë∆∞·ª£c chuy·ªÉn kho·∫£n.</small>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="section-title mb-3"><i class="bi bi-receipt"></i> T√≥m t·∫Øt ƒë∆°n h√†ng</h5>

          <div id="checkout-error" class="alert alert-danger d-none"></div>

          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead class="table-light">
                <tr>
                  <th>S·∫£n ph·∫©m</th>
                  <th class="text-center">SL</th>
                  <th class="text-end">ƒê∆°n gi√°</th>
                  <th class="text-end">Th√†nh ti·ªÅn</th>
                </tr>
              </thead>
              <tbody id="cart-lines">
                 <tr th:if="${cart != null and cart.lines != null}" th:each="line : ${cart.lines}">
                     <td th:text="${line.productName}">T√™n s·∫£n ph·∫©m</td>
                     <td class="text-center" th:text="${line.quantity}">1</td>
                     <td class="text-end" th:text="${#numbers.formatDecimal(line.price, 0, 'COMMA', 0, 'POINT')} + 'ƒë'">0ƒë</td>
                     <td class="text-end" th:text="${#numbers.formatDecimal(line.lineTotal, 0, 'COMMA', 0, 'POINT')} + 'ƒë'">0ƒë</td>
                 </tr>
              </tbody>
            </table>
          </div>

          <div class="mb-3">
            <h6 class="mb-2">Ph∆∞∆°ng th·ª©c giao h√†ng *</h6>
            <div class="form-check">
              <input class="form-check-input ship-method" type="radio" name="ship" id="shipSaving" value="SAVING">
              <label class="form-check-label" for="shipSaving">
                <span class="badge text-bg-success badge-legend">SAVING</span> ‚Äì Giao ti·∫øt ki·ªám (<span class="ship-cost" data-method="SAVING">20,000</span>ƒë)
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input ship-method" type="radio" name="ship" id="shipFast" value="FAST" checked>
              <label class="form-check-label" for="shipFast">
                <span class="badge text-bg-primary badge-legend">FAST</span> ‚Äì Giao nhanh (<span class="ship-cost" data-method="FAST">30,000</span>ƒë, mi·ªÖn ph√≠ t·ª´ 500k)
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input ship-method" type="radio" name="ship" id="shipExpress" value="EXPRESS">
              <label class="form-check-label" for="shipExpress">
                <span class="badge text-bg-danger badge-legend">EXPRESS</span> ‚Äì H·ªèa t·ªëc (<span class="ship-cost" data-method="EXPRESS">60,000</span>ƒë)
              </label>
            </div>
          </div>

          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between">
              <span>T·∫°m t√≠nh</span><strong id="sum-subtotal">0ƒë</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Ph√≠ v·∫≠n chuy·ªÉn</span><strong id="sum-ship">0ƒë</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>T·ªïng c·ªông</span><strong id="sum-total" class="text-danger">0ƒë</strong>
            </li>
          </ul>

          <button id="btnCheckout" class="btn btn-danger w-100 btn-spinner">
            <span class="lbl"><i class="bi bi-bag-check"></i> X√°c nh·∫≠n ƒë·∫∑t h√†ng</span>
            <span class="spinner-border d-none" role="status" aria-hidden="true"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script th:inline="javascript">
  // ƒê·ªãnh d·∫°ng ti·ªÅn Vi·ªát Nam
  const fmtVND = (n) => {
    try { return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND', maximumFractionDigits: 0 }).format(n ?? 0); }
    catch { return (n ?? 0) + 'ƒë'; }
  };

  // L·∫•y CSRF token t·ª´ th·∫ª meta
  function csrfHeaders(){
    const h = {};
    const t = document.querySelector('meta[name="_csrf"]')?.content;
    const hn= document.querySelector('meta[name="_csrf_header"]')?.content;
    if (t && hn) h[hn]=t;
    return h;
  }

  // H√†m g·ªçi API fetch JSON, x·ª≠ l√Ω l·ªói 401/403 v√† c√°c l·ªói kh√°c
  async function fetchJson(url, opt = {}){
    try {
        const res = await fetch(url, opt);
        const ct = res.headers.get('content-type')||'';

        if(!res.ok){
          let errorData = null;
          let errorMsg = `HTTP ${res.status} ‚Äì ${res.statusText || 'Y√™u c·∫ßu th·∫•t b·∫°i'}`;
          try {
             // Th·ª≠ ƒë·ªçc l·ªói d∆∞·ªõi d·∫°ng text tr∆∞·ªõc
             const textError = await res.text();
             errorMsg = textError || errorMsg; // ∆Øu ti√™n text l·ªói n·∫øu c√≥
             // Th·ª≠ parse JSON n·∫øu content type l√† json
             if (ct.includes('json')) {
                errorData = JSON.parse(textError); // Parse l·∫°i t·ª´ text ƒë√£ ƒë·ªçc
                if(errorData && errorData.message) errorMsg = errorData.message;
             }
          } catch(parseErr) { /* B·ªè qua l·ªói parse */ }

          // X·ª≠ l√Ω l·ªói x√°c th·ª±c (401 Unauthorized, 403 Forbidden) -> Chuy·ªÉn h∆∞·ªõng ƒëƒÉng nh·∫≠p
          if (res.status === 401 || res.status === 403) {
              window.location.href = LOGIN_URL + '?redirect=' + encodeURIComponent(window.location.pathname + window.location.search);
              throw new Error('Y√™u c·∫ßu x√°c th·ª±c.'); // N√©m l·ªói ƒë·ªÉ d·ª´ng h√†m g·ªçi
          }
          // C√°c l·ªói kh√°c
          throw new Error(errorMsg);
        }

        // Ch·ªâ parse JSON n·∫øu c√≥ v√† response OK
        if(ct.includes('json')) {
            return res.json();
        }
        // Tr·∫£ v·ªÅ null n·∫øu kh√¥ng ph·∫£i JSON (v√≠ d·ª•: response r·ªóng khi x√≥a th√†nh c√¥ng)
        return null;
    } catch (networkErr) {
        // X·ª≠ l√Ω l·ªói m·∫°ng
        console.error("L·ªói m·∫°ng:", networkErr);
        throw new Error("L·ªói k·∫øt n·ªëi m·∫°ng. Vui l√≤ng ki·ªÉm tra l·∫°i.");
    }
  }

  // T√≠nh ph√≠ ship d·ª±a tr√™n ph∆∞∆°ng th·ª©c v√† t·ªïng ti·ªÅn h√†ng (ƒê·ªíNG B·ªò V·ªöI BACKEND)
  function shipFee(method, subtotal){
    const sub = subtotal || 0;
    if (sub <= 0) return 0; // Kh√¥ng c√≥ h√†ng th√¨ kh√¥ng t√≠nh ship

    const feeMap = {
        SAVING: 20000,
        EXPRESS: 60000,
        FAST: (sub >= 500000) ? 0 : 30000 // FAST: Mi·ªÖn ph√≠ t·ª´ 500k, c√≤n l·∫°i 30k
    };
    return feeMap[method] ?? feeMap['FAST']; // M·∫∑c ƒë·ªãnh l√† FAST n·∫øu method kh√¥ng h·ª£p l·ªá
  }

  // ---- State ----
  let SHIP_METHOD = 'FAST'; // M·∫∑c ƒë·ªãnh khi t·∫£i trang
  const checkoutErrorDiv = document.getElementById('checkout-error');

  // ---- Render UI ----
  // Render c√°c d√≤ng s·∫£n ph·∫©m trong gi·ªè h√†ng
  function renderCartLines(cart){
    const tbody = document.getElementById('cart-lines');
    tbody.innerHTML = ''; // X√≥a n·ªôi dung c≈©
    if (!cart || !cart.lines || cart.lines.length === 0) {
        // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p gi·ªè h√†ng r·ªóng (c√≥ th·ªÉ ·∫©n b·∫£ng v√† hi·ªán th√¥ng b√°o)
        console.warn("Gi·ªè h√†ng r·ªóng ho·∫∑c kh√¥ng h·ª£p l·ªá ƒë·ªÉ render.");
        // Redirect v·ªÅ trang s·∫£n ph·∫©m n·∫øu kh√¥ng ph·∫£i lu·ªìng Buy Now v√† gi·ªè r·ªóng
        if (!IS_BUY_NOW) {
             alert('Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.');
             window.location.href = PRODUCTS_URL;
        }
        return;
    }
    (cart.lines).forEach(l=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${l.productName || 'N/A'}</td>
        <td class="text-center">${l.quantity || 0}</td>
        <td class="text-end">${fmtVND(l.price)}</td>
        <td class="text-end">${fmtVND(l.lineTotal)}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // C·∫≠p nh·∫≠t ph·∫ßn T√≥m t·∫Øt ƒë∆°n h√†ng (subtotal, shipping, total)
  function updateSummary(){
    const subtotal = CART?.subtotal || 0;
    const fee = shipFee(SHIP_METHOD, subtotal);
    const total = subtotal + fee;

    document.getElementById('sum-subtotal').textContent = fmtVND(subtotal);
    document.getElementById('sum-ship').textContent     = fmtVND(fee);
    document.getElementById('sum-total').textContent    = fmtVND(total);

    // C·∫≠p nh·∫≠t gi√° hi·ªÉn th·ªã tr√™n label c·ªßa radio button (n·∫øu c·∫ßn)
    document.querySelectorAll('.ship-cost').forEach(span => {
        const method = span.dataset.method;
        const currentFee = shipFee(method, subtotal);
        // C·∫≠p nh·∫≠t text, v√≠ d·ª•: " (0ƒë)" ho·∫∑c " (30,000ƒë)"
        // B·∫°n c√≥ th·ªÉ t√πy ch·ªânh hi·ªÉn th·ªã n√†y
    });
  }

  // ---- Event Listeners ----
  // Hi·ªán/·∫©n th√¥ng tin bank khi ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n
  document.querySelectorAll('.payment-method').forEach(radio => {
    radio.addEventListener('change', (e) => {
      const showBank = (e.target.id === 'payBANK' && e.target.checked);
      document.getElementById('bankInfo').classList.toggle('d-none', !showBank);
    });
  });

  // Thay ƒë·ªïi ph∆∞∆°ng th·ª©c giao h√†ng
  document.querySelectorAll('.ship-method').forEach(radio => {
    radio.addEventListener('change', (e) => {
      if(e.target.checked){
        SHIP_METHOD = e.target.value;
        updateSummary(); // T√≠nh l·∫°i t·ªïng ti·ªÅn khi ƒë·ªïi ph∆∞∆°ng th·ª©c ship
      }
    });
  });

  // N√∫t x√°c nh·∫≠n ƒë·∫∑t h√†ng
  const btnCheckout = document.getElementById('btnCheckout');
  function setBusy(on){
    btnCheckout.disabled = on;
    btnCheckout.querySelector('.spinner-border').classList.toggle('d-none', on);
    btnCheckout.querySelector('.lbl').classList.toggle('d-none', on);
    // ·∫®n th√¥ng b√°o l·ªói c≈© khi b·∫Øt ƒë·∫ßu x·ª≠ l√Ω
    if(on && checkoutErrorDiv) checkoutErrorDiv.classList.add('d-none');
  }

  // X·ª≠ l√Ω click n√∫t "X√°c nh·∫≠n ƒë·∫∑t h√†ng"
  btnCheckout.addEventListener('click', async ()=>{
    // 1. L·∫•y th√¥ng tin t·ª´ form
    const name = document.getElementById('name').value.trim();
    const phone= document.getElementById('phone').value.trim();
    const addr = document.getElementById('address').value.trim();
    const note = document.getElementById('note').value.trim();
    const payMethod = document.querySelector('input[name="pay"]:checked')?.value || 'COD';
    const shipMethod = document.querySelector('input[name="ship"]:checked')?.value || 'FAST'; // L·∫•y ship method ƒë√£ ch·ªçn

    // 2. Validate th√¥ng tin c∆° b·∫£n
    if(!name || !phone || !addr){
      alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß H·ªç t√™n, S·ªë ƒëi·ªán tho·∫°i v√† ƒê·ªãa ch·ªâ giao h√†ng.');
      return;
    }
    // (Th√™m validate s·ªë ƒëi·ªán tho·∫°i, email n·∫øu c·∫ßn)

    // 3. Chu·∫©n b·ªã request body
    const checkoutRequestData = {
      recipientName: name,
      recipientPhone: phone,
      shippingAddress: addr,
      note: note || null, // G·ª≠i null n·∫øu ghi ch√∫ r·ªóng
      paymentMethod: payMethod,
      shippingMethod: shipMethod // G·ª≠i ph∆∞∆°ng th·ª©c ship ƒë√£ ch·ªçn
    };

    let apiUrl = '';
    let requestBody;

    if (IS_BUY_NOW) {
        // Lu·ªìng Mua Ngay
        apiUrl = `${API_BASE}/checkout/buy-now`;
        requestBody = JSON.stringify({
          checkout: checkoutRequestData,
          productId: BUY_NOW_PRODUCT_ID,
          quantity: BUY_NOW_QTY
        });
    } else {
        // Lu·ªìng Gi·ªè h√†ng
        apiUrl = `${API_BASE}/checkout`;
        requestBody = JSON.stringify(checkoutRequestData);
    }

    // 4. G·ªçi API
    try{
      setBusy(true); // Hi·ªÉn th·ªã spinner

      const response = await fetchJson(apiUrl, {
        method:'POST',
        headers: { 'Content-Type':'application/json', ...csrfHeaders() }, // G·ª≠i k√®m CSRF
        body: requestBody
      });

      // 5. X·ª≠ l√Ω k·∫øt qu·∫£ tr·∫£ v·ªÅ (CheckoutResponse)
      if (response) {
          if (response.paymentMethod === 'VNPAY' && response.paymentUrl) {
              // Chuy·ªÉn h∆∞·ªõng sang VNPAY
              window.location.href = response.paymentUrl;
          } else {
              // COD, BANK ho·∫∑c VNPAY l·ªói kh√¥ng c√≥ URL -> Chuy·ªÉn ƒë·∫øn trang th√†nh c√¥ng
              window.location.href = ORDER_SUCCESS_URL_BASE + response.orderId;
          }
      } else {
          // Tr∆∞·ªùng h·ª£p API kh√¥ng tr·∫£ v·ªÅ response h·ª£p l·ªá (fetchJson ƒë√£ x·ª≠ l√Ω 401/403)
          throw new Error("ƒê·∫∑t h√†ng kh√¥ng th√†nh c√¥ng. Kh√¥ng nh·∫≠n ƒë∆∞·ª£c th√¥ng tin ƒë∆°n h√†ng.");
      }

    } catch(err) {
      // Hi·ªÉn th·ªã l·ªói cho ng∆∞·ªùi d√πng
      console.error("L·ªói checkout:", err);
      if(checkoutErrorDiv) {
          checkoutErrorDiv.textContent = err.message || 'ƒê·∫∑t h√†ng th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.';
          checkoutErrorDiv.classList.remove('d-none');
      } else {
          alert(err.message || 'ƒê·∫∑t h√†ng th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.');
      }
    } finally {
      setBusy(false); // ·∫®n spinner
    }
  });

  // ---- Initialization ----
  // H√†m kh·ªüi t·∫°o khi trang t·∫£i xong
  (async function init(){
    try{
      // N·∫øu kh√¥ng ph·∫£i "Mua ngay", fetch gi·ªè h√†ng th·∫≠t t·ª´ API
      // N·∫øu l√† "Mua ngay", CART ƒë√£ ƒë∆∞·ª£c set t·ª´ Thymeleaf
      if (!IS_BUY_NOW) {
          // Ch·ªâ fetch gi·ªè h√†ng n·∫øu CART ban ƒë·∫ßu l√† null ho·∫∑c r·ªóng (tr√°nh fetch l·∫°i kh√¥ng c·∫ßn thi·∫øt)
          if (!CART || !CART.lines || CART.lines.length === 0) {
              CART = await fetchJson(API_BASE, { headers: csrfHeaders() });
          }
      }

      // Render l·∫°i gi·ªè h√†ng (th·∫≠t ho·∫∑c ·∫£o) v√† c·∫≠p nh·∫≠t t·ªïng ti·ªÅn
      renderCartLines(CART);
      updateSummary(); // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn d·ª±a tr√™n CART v√† SHIP_METHOD m·∫∑c ƒë·ªãnh

    } catch(err) {
        // L·ªói n√†y ch·ªß y·∫øu x·∫£y ra khi fetch gi·ªè h√†ng th·∫≠t b·ªã l·ªói (401/403 ƒë√£ b·ªã x·ª≠ l√Ω)
        console.error("L·ªói t·∫£i gi·ªè h√†ng:", err);
        // C√≥ th·ªÉ hi·ªÉn th·ªã th√¥ng b√°o l·ªói tr√™n UI thay v√¨ alert
        if(checkoutErrorDiv) {
            checkoutErrorDiv.textContent = err.message || 'Kh√¥ng t·∫£i ƒë∆∞·ª£c th√¥ng tin gi·ªè h√†ng.';
            checkoutErrorDiv.classList.remove('d-none');
        } else {
             alert(err.message || 'Kh√¥ng t·∫£i ƒë∆∞·ª£c th√¥ng tin gi·ªè h√†ng.');
        }
        // V√¥ hi·ªáu h√≥a n√∫t checkout n·∫øu kh√¥ng t·∫£i ƒë∆∞·ª£c gi·ªè h√†ng
        if(btnCheckout) btnCheckout.classList.add('disabled');
    }
  })();
</script>

<div th:replace="~{fragments/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>