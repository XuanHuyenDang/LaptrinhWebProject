<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quản lý đơn hàng - Florio Admin</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
	rel="stylesheet">
<style>
/* copy style from your admin-dashboard to ensure pixel consistency */
body {
	background-color: #fffafc;
	font-family: "Segoe UI", sans-serif;
}

/* Sidebar */
.sidebar {
	position: fixed;
	top: 0;
	left: 0;
	height: 100vh;
	width: 250px;
	background: linear-gradient(180deg, #ffb6c1 0%, #ffe5ec 100%);
	color: #4a4a4a;
	padding-top: 1rem;
	box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
}

.sidebar h5 {
	font-weight: bold;
	color: #c2185b;
}

.sidebar a {
	color: #5a5a5a;
	text-decoration: none;
	display: block;
	padding: 10px 20px;
	border-radius: 8px;
	margin: 3px 10px;
	transition: all 0.3s ease;
	font-weight: 500;
}

.sidebar a:hover, .sidebar a.active {
	background: #fff;
	color: #c2185b;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
	transform: translateX(3px);
}

.sidebar i {
	color: #c2185b;
}

main {
	margin-left: 270px;
	padding: 30px;
}

/* Cards */
.card {
	border-radius: 15px;
	border: none;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
	transition: transform 0.2s ease;
}

.card:hover {
	transform: translateY(-4px);
}

.card i {
	font-size: 2rem;
	margin-bottom: 10px;
}

.table {
	border-radius: 10px;
	overflow: hidden;
}

h3 {
	color: #c2185b;
	font-weight: 700;
}

.badge {
	font-size: 0.85rem;
}

/* small action buttons */
.btn-sm-custom {
	border-radius: 8px;
	padding: 6px 10px;
	font-size: 0.9rem;
	border: 1px solid rgba(0, 0, 0, 0.05);
}

.btn-edit {
	color: #0d6efd;
	background: transparent;
	border-color: rgba(13, 110, 253, 0.15);
}

.btn-edit:hover {
	background: rgba(13, 110, 253, 0.06);
}

.btn-delete {
	color: #dc3545;
	background: transparent;
	border-color: rgba(220, 53, 69, 0.12);
}

.btn-delete:hover {
	background: rgba(220, 53, 69, 0.06);
}

.text-nowrap {
	white-space: nowrap;
}
.logout-form {
  position: absolute;
  bottom: 90px;        /* Cố định ở gần cuối sidebar */
  left: 45%;
  transform: translateX(-50%); /* Căn giữa theo chiều ngang */
  text-align: center;
}
</style>
</head>
<body>

	<div th:replace="~{admin/fragments/sidebar :: sidebar(page='orders')}"></div>

	<main>
		<div class="d-flex align-items-center justify-content-between mb-4">
			<h3>
				<i class="bi bi-receipt me-2"></i>Quản lý đơn hàng
			</h3>
			<a th:href="@{/admin/orders}" class="btn btn-sm btn-outline-secondary">Xem tất cả</a>
		</div>

		<div class="row g-4 mb-4">
			<div class="col"> <a th:href="@{/admin/orders(status='Đang xử lý')}"
					class="card text-center p-3 bg-light text-decoration-none h-100">
                    <i class="bi bi-hourglass-split text-warning"></i>
					<h6 class="mt-2 text-dark">Đang xử lý</h6> <p class="fw-bold fs-6 text-warning mb-0" th:text="${countDangXuLy}">0</p> </a>
			</div>
            <div class="col">
				<a th:href="@{/admin/orders(status='Đang giao')}"
					class="card text-center p-3 bg-light text-decoration-none h-100">
                    <i class="bi bi-truck text-info"></i> <h6 class="mt-2 text-dark">Đang giao</h6>
					<p class="fw-bold fs-6 text-info mb-0" th:text="${countDangGiao}">0</p>
				</a>
			</div>
			<div class="col">
				<a th:href="@{/admin/orders(status='Hoàn tất')}"
					class="card text-center p-3 bg-light text-decoration-none h-100">
                    <i class="bi bi-check2-circle text-success"></i>
					<h6 class="mt-2 text-dark">Hoàn tất</h6>
					<p class="fw-bold fs-6 text-success mb-0" th:text="${countHoanTat}">0</p>
				</a>
			</div>
			<div class="col">
				<a th:href="@{/admin/orders(paymentMethod='VNPAY')}" class="card text-center p-3 bg-light text-decoration-none h-100">
                    <i class="bi bi-credit-card-2-front-fill text-primary"></i>
					<h6 class="mt-2 text-dark">Đơn VNPAY</h6> <p class="fw-bold fs-6 text-primary mb-0" th:text="${countVnpay}">0</p> </a>
			</div>
			</div>


		<div class="mt-2">
			<h5 class="fw-bold text-secondary mb-3">
				<i class="bi bi-basket2 me-2"></i>Danh sách đơn hàng (<span th:text="${selectedStatus != null ? selectedStatus : 'Tất cả'}"></span>)
			</h5>
			<div class="card p-0">
				<div class="card-body p-0">
					<table class="table table-bordered bg-white align-middle m-0">
						<thead class="text-center">
							<tr class="table-light">
								<th style="width: 8%">Mã đơn</th>
								<th style="width: 18%">Khách hàng</th>
								<th style="width: 30%">Sản phẩm</th>
								<th style="width: 12%">Tổng tiền</th>
								<th style="width: 12%">Ngày đặt</th>
								<th style="width: 10%">Trạng thái</th>
								<th style="width: 10%">Thao tác</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="order : ${orders}">
								<td class="text-center text-nowrap" th:text="${'#' + order.id}"></td>
								<td th:text="${order.recipientName}"></td>
								<td>
									<ul class="mb-0 ps-3">
										<li th:each="detail : ${order.details}"
											th:text="${detail.product.productName + ' x' + detail.quantity}"></li>
									</ul>
								</td>
								<td class="text-center">
                                    <span th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></span>
                                    <span th:if="${#strings.equalsIgnoreCase(order.paymentMethod, 'VNPAY')}"
                                          class="badge bg-info text-dark ms-1" style="font-size: 0.7em;">
                                        VNPAY
                                    </span>
								</td>
								<td class="text-center"
									th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}"></td>
								<td class="text-center">
                                    <span class="badge"
                                          th:classappend="${order.status == 'Hoàn tất' ? 'bg-success' :
                                                        (order.status == 'Đang giao' ? 'bg-info text-dark' :
                                                        (order.status == 'Chờ thanh toán' ? 'bg-secondary' :
                                                        (order.status == 'Đã hủy' ? 'bg-danger' : 'bg-warning text-dark')))}"
                                          th:text="${order.status}">
                                    </span>
                                    </td>
								<td class="text-center">
                                    <a th:href="@{'/admin/orders/' + ${order.id}}"
									    class="btn btn-sm-custom btn-edit me-1" title="Xem chi tiết"><i class="bi bi-eye"></i></a>
                                    </td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</main>

</body>
</html>